angular.module("app").directive("graphPie",function(){"use strict";return{restrict:"E",template:"<div></div>",replace:!0,scope:{processedjobs:"=",failedjobs:"="},link:function(a,b){var c=[{name:"success",count:Math.max(1,a.processedjobs),color:"#aec7e8"},{name:"failed",count:a.failedjobs,color:"#e7969c"}],d=0,e=(b.parent().width()-2*d)/2,f=d3.svg.arc().innerRadius(e/2).outerRadius(e),g=d3.layout.pie().value(function(a){return a.count}),h=d3.select(b[0]).append("svg:svg").attr("width",2*(e+d)).attr("height",2*(e+d)).append("svg:g").attr("transform","translate("+(e+d)+","+(e+d)+")");h.selectAll("path").data(g(c)).enter().append("svg:path").attr("d",f).attr("fill",function(a){return a.data.color}).attr("title",function(a){return a.data.count+" "+a.data.name+" jobs"}).each(function(a){this._current=a});var i=function(a){function b(a){var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return f(b(a))}}h.selectAll("path").data(g(a)).transition().duration(ANIMATION_DURATION).attrTween("d",b)};a.$watch("processedjobs",function(a,b){a!==b&&(c[0].count=a,i(c))}),a.$watch("failedjobs",function(a,b){a!==b&&(c[1].count=a,i(c))})}}});