/*! JsRender v1.0pre: http://github.com/BorisMoore/jsrender *//*
* Optimized version of jQuery Templates, for rendering to string.
* Does not require jQuery, or HTML DOM
* Integrates with JsViews (http://github.com/BorisMoore/jsviews)
* Copyright 2012, Boris Moore
* Released under the MIT License.
*/// informal pre beta commit counter: 20
this.jsviews||this.jQuery&&jQuery.views||function(e,t){function A(e){this.name="JsRender Error",this.message=e||"JsRender error"}function O(e,t){if(!L.rTag||arguments.length)u=e?"\\"+e.charAt(0):u,a=e?"\\"+e.charAt(1):a,f=t?"\\"+t.charAt(0):f,l=t?"\\"+t.charAt(0):l,L.rTag=i="(?:(?:(\\w+(?=[\\/\\s"+f+"]))|(?:(\\w+)?(:)|(>)|(\\*)))"+"\\s*((?:[^"+f+"]|"+f+"(?!"+l+"))*?)",i=new RegExp(u+a+i+"(\\/)?|(?:\\/(\\w+)))"+f+l,"g"),s=new RegExp("<.*>|([^\\\\]|^)[{}]|"+u+a+".*"+f+l);return[u,a,f,l]}function M(e){var n=this,r=n.tmpl.helpers||{};return e=(n.ctx[e]!==t?n.ctx:r[e]!==t?r:F[e]!==t?F:{})[e],typeof e!="function"?e:function(){return e.apply(n,arguments)}}function _(e,t,n,r){var i=n.converters;return i=i&&i[e]||I[e],i?i.call(t,r):(R("Unknown converter: {{"+e+":"),r)}function D(e,n,r,i,s,o){var u,a=r.tags,f=r.templates,l=o.props=o.props||{},c=l.tmpl,h=arguments.length>6?C.call(arguments,6):[],d=a&&a[e]||j[e];return d?(c&&delete l.tmpl,s=s&&r.tmpls[s-1],c=c||s||t,o.tmpl=""+c===c?f&&f[c]||B[c]||B(c):c,o.isTag=p,o.converter=i,o.view=n,o.renderContent=q,u=d.apply(o,h),u||(u==t?"":u.toString())):(R("Unknown tag: {{"+e+"}}"),"")}function P(e,n,r,i,s,o,u,a){var f,l={tmpl:s,path:n,parent:r,data:i,ctx:e,views:a?[]:{},_useKey:a?0:1,_hlp:M,_onRender:u};return r&&(f=r.views,r._useKey?(f[l.key="_"+r._useKey++]=l,l.index=r.index):f.splice(l.key=l.index=o!==t?o:f.length,0,l)),l}function H(e,n,r,i,s){var o,u;if(r&&typeof r=="object"&&!r.nodeType){for(o in r)n(o,r[o]);return e}if(!r||i===t)s&&(i=s(t,i||r));else if(""+r===r)if(i===null)delete n[r];else if(i=s?s(r,i):i)n[r]=i;return(u=c.onStoreItem)&&u(n,r,i,s),i}function B(e,t){return H(this,B,e,t,V)}function j(e,t){return H(this,j,e,t)}function F(e,t){return H(this,F,e,t)}function I(e,t){return H(this,I,e,t)}function q(e,n,i,s,u,a,f){var l,c,d,v,m,g,y,b,w,E,S=this,x="";s===p&&(w=p,s=0);if(S.isTag){y=S.tmpl;if(n||S.ctx)E={},S.ctx&&o(E,S.ctx),n&&o(E,n);n=E,b=S.props,b&&b.link===h&&(n=n||{},n.link=h),i=i||S.view,a=a||S.path,s=s||S.key}else y=S.jquery&&(S[0]||R('Unknown template: "'+S.selector+'"'))||S;if(y){i?(g=i.ctx,e===i&&(e=i.data,u=p),f=f||i._onRender):g=F,n=n&&n!==g?o(o({},g),n):g,y.fn||(y=B[y]||B(y));if(y){f=n.link!==h&&f;if(r.isArray(e)&&!u){v=w?i:s!==t&&i||P(n,a,i,e,y,s,f,p);for(l=0,c=e.length;l<c;l++)d=e[l],m=y.fn(d,P(n,a,v,d,y,(s||0)+l,f),L),x+=f?f(m,y,b):m}else v=w?i:P(n,a,i,e,y,s,f),v._onRender=f,x+=y.fn(e,v,L);return f?f(x,y,b,v.key,a):x}}return R("No template found"),""}function R(e){if(L.debugMode)throw new L.Error(e)}function U(e){R("Syntax error\n"+e)}function z(e,t,n){function c(t){t-=u,t&&f.push(e.substr(u,t).replace(g,"\\n"))}function h(t){t&&U('Unmatched or missing tag: "{{/'+t+'}}" in template:\n'+e)}function d(t,i,o,d,v,m,g,b,E,S){v&&(d=":",o="html");var x,T="",N="",C=!b&&!d&&!n;i=i||d,c(S),u=S+t.length,m?s&&f.push(["*",g.replace(y,"$1")]):i?(i==="else"&&(l[5]=e.substring(l[5],S),l=a.pop(),f=l[3],C=p),g=g?X(g,n).replace(w,function(e,t,n){return t?N+=n+",":T+=n+",",""}):"",T=T.slice(0,-1),g=g.slice(0,-1),r=[i,o||"",g,C&&[],"{"+(T?"props:{"+T+"},":"")+"path:'"+g+"'"+(N?",ctx:{"+N.slice(0,-1)+"}":"")+"}"],f.push(r),C&&(a.push(l),l=r,l[5]=u)):E&&(x=l[0],h(E!==x&&(E!=="if"||x!=="else")&&x),l[5]=e.substring(l[5],S),l=a.pop()),h(!l&&E),f=l[3]}var r,s=t&&t.allowCode,o=[],u=0,a=[],f=o,l=[,,,o];return e=e.replace(b,"\\$1"),h(a[0]&&a[0][3].pop()[0]),e.replace(i,d),c(e.length),W(o,t)}function W(e,t){var n,r,i,s,o,u,a,f,l,c,h,d,v,m,g,y,b=t?{allowCode:g=t.allowCode,debug:t.debug}:{},w=t&&t.tmpls,E=0;i=e.length,s=i?"":'"";';for(r=0;r<i;r++)n=e[r],""+n===n?s+='"'+n+'"+':(c=n[0],c==="*"?s=s.slice(0,r?-1:-3)+";"+n[1]+(r+1<i?"ret+=":""):(h=n[1],d=n[2],y=n[3],v=n[4],markup=n[5],y&&(m=$(markup,b,t,E++),W(n[3],m),w.push(m)),l=l||v.indexOf("view")>-1,s+=(c===":"?h==="html"?(u=p,"e("+d):h?(f=p,'c("'+h+'",view,this,'+d):(a=p,"((v="+d+')!=u?v:""'):(o=p,'t("'+c+'",view,this,"'+(h||"")+'",'+(y?w.length:'""')+","+v+(d?",":"")+d))+")+"));s=T+(a?"v,":"")+(o?"t=j._tag,":"")+(f?"c=j._convert,":"")+(u?"e=j.converters.html,":"")+"ret; try{\n\n"+(b.debug?"debugger;":"")+(g?"ret=":"return ")+s.slice(0,-1)+";\n\n"+(g?"return ret;":"")+"}catch(e){return j._err(e);}";try{s=new Function("data, view, j, b, u",s)}catch(S){U("Compiled template code:\n\n"+s,S)}return t&&(t.fn=s),s}function X(e,t){function u(u,a,f,l,c,d,m,g,y,b,w,E,S,x,T,N){function k(e,t,n,r,i,s,o){if(t){var u,a=(n?'view._hlp("'+n+'")':r?"view":"data")+(o?(i?"."+i:n?"":r?"":"."+t)+(s||""):(o=n?"":r?i||"":t,""));return u=o?"."+o:"",C||(a+=u),a=a.slice(0,9)==="view.data"?a.slice(5):a,C&&(a="b("+a+',"'+o+'")'+u),a}return e}c=c||"",f=f||a||w,l=l||g,y=y||T||"",c=c||"";var C=t&&y!=="(";if(!d)return o?(o=!E,o?u:'"'):s?(s=!S,s?u:'"'):(f?(i++,f):"")+(N?i?"":n?(n=h,"\b"):",":m?(i&&U(e),n=p,"\b"+l+":"):l?l.replace(v,k)+(y?(r[++i]=p,y):c):c?c:x?(r[i--]=h,x)+(y?(r[++i]=p,y):""):b?(r[i]||U(e),","):a?"":(o=E,s=S,'"'));U(e)}var n,r={},i=0,s=h,o=h;return e=(e+" ").replace(m,u),e}function V(e,n,r,i){function h(t){if(""+t===t||t.nodeType>0){try{a=t.nodeType>0?t:!s.test(t)&&d&&d(t)[0]}catch(n){}if(a){if(!a.type)return;t=B[a.getAttribute(x)],t||(e=e||"_"+E++,a.setAttribute(x,e),t=V(e,a.innerHTML,r,i),B[e]=t)}return t}}var u,a,f,l,c;n=n||"",u=h(n),i=i||(n.markup?n:{}),i.name=e,l=i.templates,!u&&n.markup&&(u=h(n.markup))&&u.fn&&(u.debug!==n.debug||u.allowCode!==n.allowCode)&&(u=u.markup);if(u!==t){e&&!r&&(k[e]=function(){return n.render.apply(n,arguments)}),u.fn||n.fn?u.fn&&(e&&e!==u.name?n=o(o({},u),i):n=u):(n=$(u,i,r,0),z(u,n));for(f in l)c=l[f],c.name!==f&&(l[f]=V(f,c,n));return n}}function $(e,t,n,r){function i(e){n[e]&&(s[e]=o(o({},n[e]),t[e]))}t=t||{};var s={markup:e,tmpls:[],links:[],render:q};return n&&(n.templates&&(s.templates=o(o({},n.templates),t.templates)),s.parent=n,s.name=n.name+"["+r+"]",s.key=r),o(s,t),n&&(i("templates"),i("tags"),i("helpers"),i("converters")),s}function J(e){return S[e]||(S[e]="&#"+e.charCodeAt(0)+";")}var n="v1.0pre",r,i,s,o,u="{",a="{",f="}",l="}",c={},h=!1,p=!0,d=e.jQuery,v=/^(?:null|true|false|\d[\d.]*|([\w$]+|~([\w$]+)|#(view|([\w$]+))?)([\w$.]*?)(?:[.[]([\w$]+)\]?)?|(['"]).*\8)$/g,m=/(\()(?=|\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*([)\]])([([]?))|(\s+)/g,g=/\r?\n/g,y=/\\(['"])/g,b=/\\?(['"])/g,w=/\x08(~)?([^\x08]+)\x08/g,E=0,S={"&":"&amp;","<":"&lt;",">":"&gt;"},x="data-jsv-tmpl",T="var j=j||"+(d?"jQuery.":"js")+"views,",N=/[\x00"&'<>]/g,C=Array.prototype.slice,k={},L={jsviews:n,sub:c,debugMode:p,render:k,templates:B,tags:j,helpers:F,converters:I,delimiters:O,View:P,_convert:_,_err:function(e){return L.debugMode?"Error: "+(e.message||e)+". ":'""'},_tmplFn:z,_tag:D,error:R,Error:A};(A.prototype=new Error).constructor=A,d?(r=d,r.templates=B,r.render=k,r.views=L,r.fn.render=q):(r=e.jsviews=L,r.extend=function(e,t){var n;e=e||{};for(n in t)e[n]=t[n];return e},r.isArray=Array&&Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}),o=r.extend,j({"if":function(){var e=this,n=e.view;return n.onElse=function(e,r){var i=0,s=r.length;while(s&&!r[i++])if(i===s)return"";return n.onElse=t,e.path="",e.renderContent(n)},n.onElse(this,arguments)},"else":function(){var e=this.view;return e.onElse?e.onElse(this,arguments):""},"for":function(){var e,t=this,n="",r=arguments,i=r.length;i===0&&(i=1);for(e=0;e<i;e++)n+=t.renderContent(r[e]);return n},"*":function(e){return e}}),I({html:function(e){return e!=t?String(e).replace(N,J):""}}),O()}(this);